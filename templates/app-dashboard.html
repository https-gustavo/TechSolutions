<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoFin App</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-dark: #050505;
            --glass-surface: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #7c3aed;
            --primary-glow: #8b5cf6;
            --secondary: #06b6d4;
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
        }
        .blob-1 { top: -10%; left: -20%; width: 300px; height: 300px; background: var(--primary); }
        .blob-2 { bottom: 10%; right: -20%; width: 250px; height: 250px; background: var(--secondary); }

        .app-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 24px;
            padding-bottom: 160px;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px; /* Space for notch */
            margin-bottom: 24px;
        }
        .user-info h1 { font-size: 1.25rem; font-weight: 700; }
        .user-info p { font-size: 0.875rem; color: var(--text-muted); }
        .header-actions button {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            width: 44px; height: 44px;
            border-radius: 14px;
            color: var(--text-main);
            font-size: 1.25rem;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .card-amount { font-size: 2rem; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 20px; }
        .balance-title { font-size: 0.9rem; color: var(--text-muted); font-weight: 600; }
        .balance-amount { font-size: 2.4rem; font-weight: 800; letter-spacing: -0.5px; }
        .eye-btn {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            width: 44px; height: 44px;
            border-radius: 14px;
            color: var(--text-main);
            font-size: 1.25rem;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .balance-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
        .header-balance { margin-bottom: 16px; }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 140px;
        }
        .action-item {
            display: flex; flex-direction: column; align-items: center; gap: 16px;
            cursor: pointer;
        }
        .action-btn {
            width: 56px; height: 56px;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-glow);
            transition: all 0.2s;
        }
        .action-btn:hover { background: rgba(124, 58, 237, 0.15); border-color: var(--primary); transform: translateY(-2px); }
        .action-label { font-size: 0.75rem; color: var(--text-muted); font-weight: 500; }

        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .section-title { font-size: 1.1rem; font-weight: 600; }
        .view-all { font-size: 0.875rem; color: var(--secondary); text-decoration: none; }

        .transactions {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 100px; /* Space for navbar */
        }
        .transactions::-webkit-scrollbar { display: none; }
        .transactions { -ms-overflow-style: none; scrollbar-width: none; }

        .transaction-item {
            display: flex; align-items: center; gap: 16px;
            padding: 16px;
            background: var(--glass-surface);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            margin-bottom: 12px;
            transition: 0.2s;
        }
        .transaction-item:active { transform: scale(0.98); }
        .t-icon {
            width: 48px; height: 48px;
            border-radius: 16px;
            background: rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem;
        }
        .t-info { flex: 1; }
        .t-name { font-weight: 600; margin-bottom: 4px; }
        .t-date { font-size: 0.75rem; color: var(--text-muted); }
        .t-amount { font-weight: 700; }
        .t-amount.inc { color: var(--success); }
        .t-amount.exp { color: var(--text-main); }

        .bottom-dock {
            position: absolute;
            bottom: 16px; left: 24px; right: 24px;
            height: 72px;
            background: rgba(20, 20, 25, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 16px;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
            z-index: 100;
        }
        .dock-item {
            color: var(--text-muted);
            font-size: 1.5rem;
            padding: 12px;
            border-radius: 12px;
            transition: 0.2s;
            cursor: pointer;
            position: relative;
        }
        .dock-item.active {
            color: var(--text-main);
            background: rgba(255,255,255,0.1);
        }
        .dock-item.active::after {
            content: '';
            position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: var(--secondary); border-radius: 50%;
        }
        .dock-fab {
            width: 56px; height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--primary-glow));
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.75rem; color: white;
            box-shadow: 0 10px 20px -5px var(--primary);
            margin-top: 0;
            border: 4px solid var(--bg-dark);
            cursor: pointer;
        }

        .loader-overlay {
            position: fixed; inset: 0; background: var(--bg-dark);
            z-index: 9999; display: flex; align-items: center; justify-content: center;
            transition: opacity 0.5s;
        }
        .loader-overlay.hidden { opacity: 0; pointer-events: none; }
        .spinner-box { width: 60px; height: 60px; position: relative; }
        .circle-border { width: 100%; height: 100%; border-radius: 50%; border: 3px solid transparent; border-top-color: var(--primary); border-right-color: var(--secondary); animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 200; display: flex; align-items: flex-end; /* Bottom sheet by default */
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        
        .modal-card {
            background: #121215;
            width: 100%;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            transform: translateY(100%);
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--glass-border);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        .modal-overlay.active .modal-card { transform: translateY(0); }

        .full-screen-page {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 300;
            padding: 24px;
            padding-top: 60px; /* Space for notch/header */
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }
        .full-screen-page.active { transform: translateX(0); }
        
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        .btn-back {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            width: 40px; height: 40px;
            border-radius: 12px;
            color: var(--text-main);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: 1.25rem;
        }

        .transactions-full-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 40px;
        }
        .transactions-full-list::-webkit-scrollbar { display: none; }
        
        .error-msg {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 8px;
            display: none;
        }

        .modal-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .close-modal { background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; }

        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 0.875rem; color: var(--text-muted); margin-bottom: 8px; }
        .form-input { 
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); 
            padding: 16px; border-radius: 16px; color: white; font-size: 1rem; font-family: inherit; outline: none; transition: 0.2s;
        }
        .form-input:focus { border-color: var(--primary); background: rgba(255,255,255,0.08); }

        .btn-submit {
            width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: 600; font-size: 1rem; cursor: pointer; margin-top: 8px;
            background: linear-gradient(135deg, var(--primary), var(--primary-glow)); color: white;
            box-shadow: 0 4px 15px -3px var(--primary);
        }
        .btn-submit:active { transform: scale(0.98); }

        .app-toast {
            position: fixed;
            top: 20px; left: 50%;
            transform: translateX(-50%);
            background: rgba(20,20,25,0.9);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-main);
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            z-index: 1000;
            font-size: 0.95rem;
            display: none;
        }

        @media (max-width: 768px) {
            .app-container { padding: 16px; padding-bottom: 120px; }
            .actions-grid { grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 100px; }
            .bottom-dock { height: 64px; left: 16px; right: 16px; }
            .balance-amount { font-size: 2rem; }
            .card-amount { font-size: 1.6rem; }
        }

        @media (max-width: 480px) {
            .app-container { padding: 12px; padding-bottom: 100px; }
            header { margin-top: 12px; margin-bottom: 16px; }
            .actions-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 80px; }
            .action-btn { width: 52px; height: 52px; }
            .bottom-dock { height: 60px; left: 12px; right: 12px; }
            .dock-item { font-size: 1.3rem; padding: 10px; }
            .dock-fab { width: 52px; height: 52px; font-size: 1.5rem; }
            .balance-amount { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div id="app-toast" class="app-toast"></div>

    <div class="loader-overlay" id="loader">
        <div class="spinner-box">
            <div class="circle-border"></div>
        </div>
    </div>

    <div class="modal-overlay" id="transaction-modal">
        <div class="modal-card">
            <div class="modal-title">
                <span id="modal-title-text">Nova Transação</span>
                <button class="close-modal" onclick="closeModal()"><i class="ph ph-x"></i></button>
            </div>
            <div class="form-group">
                <label class="form-label">Valor</label>
                <input type="number" id="tx-amount" class="form-input" placeholder="0,00" step="0.01">
            </div>
            <div class="form-group">
                <label class="form-label">Descrição</label>
                <input type="text" id="tx-desc" class="form-input" placeholder="Ex: Mercado, Salário...">
            </div>
            <div id="modal-error" class="error-msg">Preencha todos os campos corretamente!</div>
            <button class="btn-submit" onclick="submitTransaction()">Salvar</button>
        </div>
    </div>

    <div class="full-screen-page" id="transactions-page" style="display: none;">
        <div class="page-header">
            <button class="btn-back" onclick="closeTransactionsPage()"><i class="ph ph-arrow-left"></i></button>
            <h2>Extrato Completo</h2>
            <div style="width: 40px;"></div>
        </div>
            <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 16px;">
                Aqui você acompanha todas as receitas e despesas registradas, com data e valor.
            </p>
        <div class="transactions-full-list" id="full-transactions-list">
        </div>
    </div>

    <div class="app-container">
        <header>
            <div class="user-info">
                <p>Bom dia,</p>
                <h1 id="user-name">Gustavo Menezes</h1>
            </div>
            <div class="header-actions">
                <button><i class="ph ph-bell"></i></button>
                <button onclick="setUserName()"><i class="ph ph-user"></i></button>
            </div>
        </header>
        
        <div class="header-balance">
            <div class="balance-title">Saldo disponível</div>
            <div class="balance-row">
                <div class="balance-amount" id="balance-amount">R$ 2.000,00</div>
                <button class="eye-btn" id="balance-eye" onclick="toggleBalance()"><i class="ph ph-eye"></i></button>
            </div>
        </div>

        

        <div class="actions-grid">
            <div class="action-item" onclick="openModal('income')">
                <div class="action-btn" style="background: rgba(16, 185, 129, 0.1); color: #10b981; border-color: rgba(16, 185, 129, 0.2);"><i class="ph ph-arrow-up"></i></div>
                <span class="action-label">Receita</span>
            </div>
            <div class="action-item" onclick="openModal('expense')">
                <div class="action-btn" style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border-color: rgba(239, 68, 68, 0.2);"><i class="ph ph-arrow-down"></i></div>
                <span class="action-label">Despesa</span>
            </div>
            <div class="action-item" onclick="showToast('Metas em breve')">
                <div class="action-btn"><i class="ph ph-target"></i></div>
                <span class="action-label">Metas</span>
            </div>
            <div class="action-item" onclick="openTransactionsPage()">
                <div class="action-btn"><i class="ph ph-file-text"></i></div>
                <span class="action-label">Extrato</span>
            </div>
        </div>

        

        <div class="bottom-dock">
            <div class="dock-item active"><i class="ph ph-house"></i></div>
            <div class="dock-item"><i class="ph ph-chart-pie-slice"></i></div>
            <div class="dock-fab" onclick="openModal('expense')"><i class="ph ph-plus"></i></div>
            <div class="dock-item"><i class="ph ph-wallet"></i></div>
            <div class="dock-item"><i class="ph ph-user"></i></div>
        </div>
    </div>

    <script>
        // Data State
        let state = {
            netWorth: 2000.00,
            income: 8250.00,
            expense: 3420.00,
            transactions: [
                { id: 1, name: 'Spotify Premium', date: 'Hoje, 10:42', amount: -12.99, type: 'expense', icon: 'ph-spotify-logo', color: '#f472b6' },
                { id: 2, name: 'Supermercado', date: 'Ontem, 17:30', amount: -84.50, type: 'expense', icon: 'ph-basket', color: '#38bdf8' },
                { id: 3, name: 'Salário Mensal', date: '28 Out, 09:00', amount: 5200.00, type: 'income', icon: 'ph-briefcase', color: '#4ade80' },
                { id: 4, name: 'Cafeteria', date: '27 Out, 08:15', amount: -6.50, type: 'expense', icon: 'ph-coffee', color: '#fbbf24' },
                { id: 5, name: 'Steam Games', date: '25 Out, 21:20', amount: -59.99, type: 'expense', icon: 'ph-game-controller', color: '#a78bfa' }
            ]
        };
        let balanceHidden = false;

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }
        function getStoredName() {
            try { return localStorage.getItem('userName') || ''; } catch (_) { return ''; }
        }
        function setStoredName(name) {
            try { localStorage.setItem('userName', name); } catch (_) {}
        }
        async function setUserName() {
            let name = '';
            if (navigator.contacts && navigator.contacts.select) {
                try {
                    const contacts = await navigator.contacts.select(['name'], { multiple: false });
                    if (contacts && contacts[0] && contacts[0].name && contacts[0].name[0]) {
                        name = contacts[0].name[0];
                    }
                } catch (_) {}
            }
            if (!name) {
                name = (window.prompt('Qual seu nome?') || '').trim();
            }
            if (name) {
                setStoredName(name);
                const nameEl = document.getElementById('user-name');
                if (nameEl) nameEl.textContent = name;
            }
        }
        function loadUserName() {
            const name = getStoredName();
            const nameEl = document.getElementById('user-name');
            if (nameEl && name) nameEl.textContent = name;
        }

        function updateUI() {
            const netWorthEl = document.getElementById('total-net-worth');
            const netWorthPillEl = document.getElementById('total-net-worth-pill');
            const netWorthBoxEl = document.getElementById('total-net-worth-box');
            const balanceEl = document.getElementById('balance-amount');
            if (netWorthEl) netWorthEl.textContent = formatCurrency(state.netWorth);
            if (netWorthPillEl) netWorthPillEl.textContent = formatCurrency(state.netWorth);
            if (netWorthBoxEl) netWorthBoxEl.textContent = formatCurrency(state.netWorth);
            if (balanceEl) balanceEl.textContent = balanceHidden ? 'R$ ••••••' : formatCurrency(state.netWorth);
            const eyeIcon = document.querySelector('#balance-eye i');
            if (eyeIcon) eyeIcon.className = balanceHidden ? 'ph ph-eye-slash' : 'ph ph-eye';
            const incomeEl = document.getElementById('total-income');
            const expenseEl = document.getElementById('total-expense');
            if (incomeEl) incomeEl.textContent = formatCurrency(state.income);
            if (expenseEl) expenseEl.textContent = formatCurrency(state.expense);

            

            const fullList = document.getElementById('full-transactions-list');
            if (fullList) {
                fullList.innerHTML = '';
                state.transactions.forEach(t => {
                    fullList.appendChild(createTransactionElement(t));
                });
            }
            const nameEl = document.getElementById('user-name');
            const storedName = getStoredName();
            if (nameEl && storedName) nameEl.textContent = storedName;
        }

        function toggleBalance() {
            balanceHidden = !balanceHidden;
            updateUI();
        }

        function createTransactionElement(t) {
            const item = document.createElement('div');
            item.className = 'transaction-item';
            const isInc = t.type === 'income';
            const colorClass = isInc ? 'inc' : 'exp';
            const sign = isInc ? '+' : '';
            
            item.innerHTML = `
                <div class="t-icon" style="color: ${t.color};"><i class="ph ${t.icon}"></i></div>
                <div class="t-info">
                    <div class="t-name">${t.name}</div>
                    <div class="t-date">${t.date}</div>
                </div>
                <div class="t-amount ${colorClass}">${sign}${formatCurrency(t.amount)}</div>
            `;
            return item;
        }

        let currentTxType = 'expense';

        function openModal(type) {
            currentTxType = type;
            const isIncome = type === 'income';
            document.getElementById('modal-title-text').textContent = isIncome ? 'Nova Receita' : 'Nova Despesa';
            document.getElementById('tx-amount').value = '';
            document.getElementById('tx-desc').value = '';
            document.getElementById('modal-error').style.display = 'none';
            
            const modal = document.getElementById('transaction-modal');
            modal.classList.add('active');
            
            // Focus input after transition
            setTimeout(() => document.getElementById('tx-amount').focus(), 100);
        }

        function closeModal() {
            document.getElementById('transaction-modal').classList.remove('active');
        }

        function openTransactionsPage() {
            const page = document.getElementById('transactions-page');
            page.style.display = 'block';
            page.classList.add('active');
        }

        function closeTransactionsPage() {
            const page = document.getElementById('transactions-page');
            page.classList.remove('active');
            page.style.display = 'none';
        }

        function submitTransaction() {
            const amountStr = document.getElementById('tx-amount').value;
            const name = document.getElementById('tx-desc').value;
            const errorMsg = document.getElementById('modal-error');

            if (!amountStr || !name) {
                errorMsg.textContent = "Preencha todos os campos!";
                errorMsg.style.display = 'block';
                return;
            }
            
            const amount = parseFloat(amountStr);
            if (isNaN(amount) || amount <= 0) {
                errorMsg.textContent = "Valor inválido!";
                errorMsg.style.display = 'block';
                return;
            }

            const isIncome = currentTxType === 'income';
            
            const newTx = {
                id: Date.now(),
                name: name,
                date: 'Agora',
                amount: isIncome ? amount : -amount,
                type: currentTxType,
                icon: isIncome ? 'ph-trend-up' : 'ph-shopping-cart',
                color: isIncome ? '#10b981' : '#ef4444'
            };

            state.transactions.unshift(newTx);
            
            if (isIncome) {
                state.income += amount;
                state.netWorth += amount;
            } else {
                state.expense += amount;
                state.netWorth -= amount;
            }

            updateUI();
            closeModal();
        }

        function hideLoader() {
            const loader = document.getElementById('loader');
            if (loader && !loader.classList.contains('hidden')) {
                loader.classList.add('hidden');
            }
        }

        function showToast(text) {
            const toast = document.getElementById('app-toast');
            if (!toast) return;
            toast.textContent = text;
            toast.style.display = 'block';
            clearTimeout(window.__toastTimer);
            window.__toastTimer = setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }

        window.addEventListener('load', () => {
            loadUserName();
            updateUI();
            setTimeout(hideLoader, 1000);
        });
        
        // Fallback
        setTimeout(hideLoader, 3000);

        // Simple interactivity
        document.querySelectorAll('.dock-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.dock-item').forEach(i => i.classList.remove('active'));
                if(!item.classList.contains('dock-fab')) {
                    item.classList.add('active');
                }

                const icon = item.querySelector('i');
                if (!icon) return;
                if (icon.classList.contains('ph-house')) {
                    showToast('Tela inicial');
                } else if (icon.classList.contains('ph-chart-pie-slice')) {
                    openTransactionsPage();
                    showToast('Extrato');
                } else if (icon.classList.contains('ph-wallet')) {
                    showToast('Carteira em breve');
                } else if (icon.classList.contains('ph-user')) {
                    showToast('Perfil em breve');
                }
            });
        });
    </script>
</body>
</html>
